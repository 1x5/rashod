# Расход - Приложение для учета расходов на производстве

## Обзор
"Расход" - это Android-приложение для учета и управления расходами при выполнении производственных заказов. 
Приложение позволяет отслеживать финансовые показатели, считать прибыль и рентабельность проектов.

## Основные функции
- Управление заказами (создание, редактирование, удаление)
- Учет расходов по категориям (материалы, инструменты, транспорт и др.)
- Автоматический расчет прибыли и рентабельности
- Возможность прикрепления фотографий к заказам
- Полноценная работа в офлайн-режиме
- Поддержка светлой и темной темы

## Технический стек
- **UI:** Jetpack Compose, Material 3
- **Архитектура:** MVVM, Clean Architecture
- **Локальное хранилище:** Room Database
- **Внедрение зависимостей:** Hilt
- **Асинхронность:** Kotlin Coroutines, Flow

## Недавние исправления

### 1. Исправление проблемы с SQLite PRAGMA
Исправлена ошибка в инициализации базы данных, связанная с неправильным вызовом PRAGMA-директив SQLite.
Вместо использования `execSQL` теперь используется `query` для выполнения PRAGMA-директив:

```kotlin
// Было:
db.execSQL("PRAGMA foreign_keys = ON")
db.execSQL("PRAGMA journal_mode = WAL")
db.execSQL("PRAGMA synchronous = NORMAL")

// Стало:
db.query("PRAGMA foreign_keys = ON").close()
db.query("PRAGMA synchronous = NORMAL").close()
// WAL устанавливается через setJournalMode в билдере Room
```

### 2. Улучшения работы с базой данных
- Добавлена проверка целостности базы данных при запуске
- Реализован механизм автоматического восстановления при повреждении БД
- Улучшено логирование для отладки проблем с БД

## Установка и запуск

### Требования
- Android 8.0 (API 26) или выше
- Android Studio Iguana или новее
- JDK 11

### Шаги установки
1. Клонируйте репозиторий
   ```
   git clone https://github.com/your-username/rashod.git
   ```
2. Откройте проект в Android Studio
3. Синхронизируйте Gradle-зависимости
4. Запустите приложение на эмуляторе или реальном устройстве

## Решение типичных проблем

### Проблема с базой данных
Если приложение вылетает с ошибкой базы данных, можно попробовать:

1. Очистить данные приложения (Settings → Apps → Расход → Storage → Clear Data)
2. Переустановить приложение
3. Проверить логи через ADB:
   ```
   adb logcat '*:E' | grep -i "rashod\|database"
   ```

### Проблема с несколькими устройствами
Если к компьютеру подключено несколько устройств, указывайте конкретное устройство:
```
adb -s DEVICE_SERIAL logcat '*:E' | grep -i "rashod"
```

## Разработка и контрибьютинг

### Рекомендации по коду
- Следуйте принципам Clean Architecture
- Используйте coroutines для всех асинхронных операций
- Добавляйте подробное логирование для критических операций
- Обеспечивайте обработку исключений во всех критических компонентах

### Flow для PR
1. Создайте отдельную ветку для новой функциональности
2. Реализуйте изменения и тесты
3. Убедитесь, что приложение собирается и работает корректно
4. Создайте PR с подробным описанием изменений

## Лицензия
Copyright © 2024 
Использование и распространение согласно лицензии. 